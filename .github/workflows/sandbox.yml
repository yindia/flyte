name: Build & Push Sandbox Docker Image

on:
  pull_request:
    paths:
      - docker/**
      - charts/**
      - .github/workflows/sandbox.yml

jobs:
  trigger-sandbox-build:
    name: Sandbox build
    uses: ./.github/workflows/buildx_build.yaml
    with:
      context: .
      dockerfile: docker/sandbox/Dockerfile
      repository: flyte-sandbox
      version: latest
      args: ""
      push: false
    secrets:
      FLYTE_BOT_PAT: ${{ secrets.FLYTE_BOT_PAT }}
      FLYTE_BOT_USERNAME: ${{ secrets.FLYTE_BOT_USERNAME }}

  trigger-sandbox-ultra-build:
    name: Sandbox lite ultra
    uses: ./.github/workflows/buildx_build.yaml
    with:
      context: docker/sandbox-lite
      dockerfile:  docker/sandbox-ultra/images/dockerfiles/k3s/Dockerfile
      repository: flyte-sandbox-ultra
      version: latest
      args: ""
      push: false
    secrets:
      FLYTE_BOT_PAT: ${{ secrets.FLYTE_BOT_PAT }}
      FLYTE_BOT_USERNAME: ${{ secrets.FLYTE_BOT_USERNAME }}

  trigger-sandbox-lite-build:
    name: Sandbox lite build
    uses: ./.github/workflows/buildx_build.yaml
    with:
      context: .
      dockerfile:  docker/sandbox-lite/Dockerfile
      repository: flyte-sandbox-lite
      version: latest
      args: ""
      push: false
    secrets:
      FLYTE_BOT_PAT: ${{ secrets.FLYTE_BOT_PAT }}
      FLYTE_BOT_USERNAME: ${{ secrets.FLYTE_BOT_USERNAME }}

  trigger-single-binary-build:
    name: Single Binary build
    uses: ./.github/workflows/buildx_build.yaml
    with:
      context: .
      dockerfile:  Dockerfile
      repository: flyte-single-binary
      version: latest
      args: ""
      push: false
    secrets:
      FLYTE_BOT_PAT: ${{ secrets.FLYTE_BOT_PAT }}
      FLYTE_BOT_USERNAME: ${{ secrets.FLYTE_BOT_USERNAME }}

